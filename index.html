<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no"
    />
    <title>Bot Premium</title>
    <script defer src="https://telegram.org/js/telegram-web-app.js"></script>

    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="card">
      <div class="title">üåüTg Premium Bot</div>
      <div class="gif">
        <img src="img.png" alt="gif" />
      </div>
      <p class="content" id="content-text"></p>
      <b id="question"></b>
      <input type="number" id="answer" placeholder="" />
      <button onclick="checkAnswer()">Tasdiqlash ‚úÖ</button>
      <p class="error" id="error-message"></p>
    </div>

    <script>
      let telegramWebApp;

      if (window.Telegram && window.Telegram.WebApp) {
        telegramWebApp = window.Telegram.WebApp;
        telegramWebApp.expand();
      }

      // Foydalanuvchi tilini aniqlash
      const urlParams = new URLSearchParams(window.location.search);
      const lang = urlParams.get("lang") || "uz";

      // Tarjimalar
      const translations = {
        uz: {
          questionText: "Quyidagi matematik amalning javobini kiriting:",
          placeholder: "Javobni kiriting:",
          emptyError: "Iltimos, javobni kiriting!",
          wrongError: "Noto‚Äòg‚Äòri javob, qaytadan urinib ko‚Äòring!",
          correct: "‚úÖ To‚Äòg‚Äòri javob!",
        },
        ru: {
          questionText: "–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ:",
          placeholder: "–í–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç:",
          emptyError: "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –æ—Ç–≤–µ—Ç!",
          wrongError: "–ù–µ–≤–µ—Ä–Ω—ã–π –æ—Ç–≤–µ—Ç, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑!",
          correct: "‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç!",
        },
      };

      // Matnlarni qo'yish
      document.getElementById("content-text").innerText =
        translations[lang].questionText;
      document.getElementById("answer").placeholder =
        translations[lang].placeholder;

      // Tasodifiy sonlar va qo'shish amali
      let num1 = Math.floor(Math.random() * 10) + 1; // Generates a number between 1 and 10
      let num2 = Math.floor(Math.random() * 10) + 1; // Generates a number between 1 and 10

      document.getElementById("question").innerText = `${num1} + ${num2} = ?`;
      let correctAnswer = num1 + num2;

      function checkAnswer() {
        let userAnswer = document.getElementById("answer").value;
        let errorMessage = document.getElementById("error-message");

        if (userAnswer === "") {
          errorMessage.innerText = translations[lang].emptyError;
        } else if (parseInt(userAnswer) !== correctAnswer) {
          errorMessage.innerText = translations[lang].wrongError;
          errorMessage.style.color = "red";
        } else {
          errorMessage.innerText = translations[lang].correct;
          errorMessage.style.color = "green";

          // Telegram WebApp ma'lumot jo'natish va yopish
          if (window.Telegram.WebApp) {
            try {
              window.Telegram.WebApp.sendData(
                JSON.stringify({ data: "user_checking_close" })
              );

              // MainButton ni yaratish va sozlash
              Telegram.WebApp.MainButton.setText("CLOSE WEBVIEW")
                .show()
                .onClick(function () {
                  Telegram.WebApp.close();
                });

              // WebApp ni avtomatik yopish
              window.Telegram.WebApp.close();
              window.Telegram.WebApp.sendData(
                JSON.stringify({ data: "user_checking_close" })
              );
            } catch (error) {
              console.error(
                "sendData ishlash jarayonida xato yuz berdi:",
                error.message
              );
            }
          } else {
            console.error("Telegram WebApp aniqlanmadi.");
          }
        }
      }
    </script>
  </body>
</html>
